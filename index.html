<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Struktur Wilayah Indonesia - Modern & Interactive</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --success-color: #2ec4b6;
            --warning-color: #ff9f1c;
            --danger-color: #e71d36;
            --dark-color: #2b2d42;
            --light-color: #f8f9fa;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .container {
            margin-top: 30px;
            margin-bottom: 30px;
        }
        
        .header-section {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }
        
        .header-section h1 {
            font-weight: 700;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            margin-bottom: 10px;
        }
        
        .header-section p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .stats-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            margin-bottom: 20px;
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
        }
        
        .stats-card i {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .stats-card.province { color: var(--primary-color); }
        .stats-card.regency { color: var(--success-color); }
        .stats-card.district { color: var(--warning-color); }
        
        .list-group-item {
            cursor: pointer;
            margin-bottom: 8px;
            border-radius: 12px !important;
            border-left: 5px solid transparent;
            transition: all 0.3s ease;
            padding: 15px;
        }
        
        .list-group-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        /* Styling per level */
        .provinsi-item { 
            border-left-color: var(--primary-color); 
            background: linear-gradient(135deg, #e9f0ff 0%, #ffffff 100%);
        }
        .kabupaten-item { 
            border-left-color: var(--success-color); 
            background: linear-gradient(135deg, #f1fff6 0%, #ffffff 100%);
            margin-left: 20px;
        }
        .kecamatan-item { 
            border-left-color: var(--warning-color); 
            background: linear-gradient(135deg, #fff8e1 0%, #ffffff 100%);
            margin-left: 40px;
        }
        
        /* Atur padding dan margin untuk daftar dalam */
        .collapse-container { padding-left: 0; }
        
        /* Agar tombol detail tetap di kanan */
        .list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }
        
        .btn-toggle {
            border-radius: 50px;
            padding: 5px 15px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .search-box {
            position: relative;
            margin-bottom: 25px;
        }
        
        .search-box input {
            border-radius: 50px;
            padding: 15px 20px 15px 50px;
            border: none;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .search-box i {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
            z-index: 10;
        }
        
        .badge-custom {
            border-radius: 10px;
            padding: 5px 10px;
            font-size: 0.75rem;
        }
        
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }
        
        .pulse {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            padding: 20px;
            opacity: 0.8;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .list-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .btn-toggle {
                margin-top: 10px;
                align-self: flex-end;
            }
            
            .kabupaten-item { margin-left: 10px; }
            .kecamatan-item { margin-left: 20px; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header-section">
        <h1><i class="fas fa-map-marked-alt me-2"></i>Struktur Administrasi Indonesia</h1>
        <p>Jelajahi hierarki wilayah Indonesia secara interaktif</p>
    </div>
    
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="stats-card province pulse">
                <i class="fas fa-map"></i>
                <h3 id="province-count">0</h3>
                <p>Provinsi</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stats-card regency">
                <i class="fas fa-city"></i>
                <h3 id="regency-count">0</h3>
                <p>Kabupaten/Kota</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stats-card district">
                <i class="fas fa-building"></i>
                <h3 id="district-count">0</h3>
                <p>Kecamatan</p>
            </div>
        </div>
    </div>
    
    <div class="glass-card p-4">
        <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" id="search-input" class="form-control" placeholder="Cari provinsi, kabupaten, atau kecamatan...">
        </div>
        
        <div id="province-container">
            <div class="loading-spinner">
                <div class="text-center">
                    <div class="spinner-border text-primary mb-3" style="width: 3rem; height: 3rem;" role="status"></div>
                    <p class="text-muted">Mengambil data dari API. Mohon tunggu...</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>Data Sumber: <a href="https://github.com/jackhw94-ai/indonesia-api" class="text-white">Indonesia API</a> | Dibuat dengan <i class="fas fa-heart text-danger"></i></p>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // --- URL RAW DATA DARI GITHUB ---
    const PROVINSI_URL = 'https://github.com/jackhw94-ai/indonesia-api/blob/main/api/provinsi.php';
    const KABUPATEN_URL = 'https://github.com/jackhw94-ai/indonesia-api/blob/main/api/kabupaten.php';
    const KECAMATAN_URL = 'https://github.com/jackhw94-ai/indonesia-api/blob/main/api/kecamatan.php';

    // Variabel global untuk data dan pencarian
    let allData = {};
    let currentSearchTerm = '';

    // --- FUNGSI UTILITY ---
    
    // Fungsi untuk mengelompokkan data menjadi hierarki
    function groupData(provinces, regencies, districts) {
        const hierarchy = {};

        // 1. Inisialisasi Provinsi
        for (const code in provinces) {
            hierarchy[code] = {
                name: provinces[code],
                regencies: {}
            };
        }

        // 2. Kelompokkan Kabupaten/Kota ke dalam Provinsi
        for (const code in regencies) {
            const provCode = code.substring(0, 2);
            if (hierarchy[provCode]) {
                hierarchy[provCode].regencies[code] = {
                    name: regencies[code].name,
                    districts: {}
                };
            }
        }

        // 3. Kelompokkan Kecamatan ke dalam Kabupaten/Kota
        for (const code in districts) {
            const regencyCode = code.substring(0, 4);
            const provCode = code.substring(0, 2);
            
            // Pastikan Provinsi dan Kabupaten/Kota ada sebelum menyisipkan Kecamatan
            if (hierarchy[provCode] && hierarchy[provCode].regencies[regencyCode]) {
                hierarchy[provCode].regencies[regencyCode].districts[code] = districts[code];
            }
        }
        
        return hierarchy;
    }
    
    // Fungsi untuk update statistik
    function updateStats(data) {
        let provinceCount = 0;
        let regencyCount = 0;
        let districtCount = 0;
        
        for (const provCode in data) {
            provinceCount++;
            for (const regCode in data[provCode].regencies) {
                regencyCount++;
                for (const distCode in data[provCode].regencies[regCode].districts) {
                    districtCount++;
                }
            }
        }
        
        // Animate counting up
        animateCount('province-count', provinceCount);
        animateCount('regency-count', regencyCount);
        animateCount('district-count', districtCount);
    }
    
    // Animasi counter
    function animateCount(elementId, target) {
        const element = document.getElementById(elementId);
        let current = 0;
        const increment = target / 50;
        const timer = setInterval(() => {
            current += increment;
            if (current >= target) {
                element.textContent = target.toLocaleString();
                clearInterval(timer);
            } else {
                element.textContent = Math.floor(current).toLocaleString();
            }
        }, 30);
    }
    
    // Fungsi untuk merender seluruh hierarki menggunakan jQuery
    function renderHierarchy(data, searchTerm = '') {
        const $container = $('#province-container');
        $container.empty().addClass('fade-in');
        
        // Jika ada pencarian, filter data
        const filteredData = searchTerm ? filterData(data, searchTerm) : data;
        
        if (Object.keys(filteredData).length === 0) {
            $container.html(`
                <div class="text-center py-5">
                    <i class="fas fa-search fa-3x text-muted mb-3"></i>
                    <h4 class="text-muted">Tidak ada hasil ditemukan</h4>
                    <p class="text-muted">Coba kata kunci pencarian lainnya</p>
                </div>
            `);
            return;
        }
        
        const $ulProvinsi = $('<div class="list-group"></div>');
        
        // Sortir Provinsi berdasarkan Kode
        const sortedProvCodes = Object.keys(filteredData).sort();

        $.each(sortedProvCodes, function(index, provCode) {
            const province = filteredData[provCode];
            
            // Item Provinsi
            const $liProvinsi = $(`<div class="list-group-item provinsi-item"></div>`);
            
            // Header (Nama + Tombol)
            const $headerProvinsi = $(`<div class="list-header"></div>`);
            
            // Hitung jumlah kabupaten
            const regencyCount = Object.keys(province.regencies).length;
            
            $headerProvinsi.append(`
                <span>
                    <strong>${highlightText(province.name, searchTerm)}</strong> 
                    <span class="badge badge-custom bg-primary ms-2">${provCode}</span>
                    <small class="text-muted d-block mt-1">${regencyCount} Kabupaten/Kota</small>
                </span>
            `);
            
            // Tombol Detail/Toggle
            const $buttonProvinsi = $(`
                <button class="btn btn-sm btn-toggle btn-primary" 
                        type="button" 
                        data-bs-toggle="collapse" 
                        data-bs-target="#collapse-regency-${provCode}" 
                        aria-expanded="false" 
                        aria-controls="collapse-regency-${provCode}">
                    <i class="fas fa-chevron-down me-1"></i> Detail
                </button>
            `);
            $headerProvinsi.append($buttonProvinsi);
            $liProvinsi.append($headerProvinsi);
            
            // Container Collapse untuk Kabupaten/Kota
            const $collapseKabupaten = $(`<div class="collapse collapse-container" id="collapse-regency-${provCode}"></div>`);
            const $ulKabupaten = $('<div class="list-group my-2"></div>');

            // Sortir Kabupaten/Kota berdasarkan Kode
            const sortedRegencyCodes = Object.keys(province.regencies).sort();

            $.each(sortedRegencyCodes, function(index, regencyCode) {
                const regency = province.regencies[regencyCode];

                // Item Kabupaten/Kota
                const $liKabupaten = $(`<div class="list-group-item kabupaten-item"></div>`);
                
                // Header Kabupaten/Kota
                const $headerKabupaten = $(`<div class="list-header"></div>`);
                
                // Hitung jumlah kecamatan
                const districtCount = Object.keys(regency.districts).length;
                
                $headerKabupaten.append(`
                    <span>
                        ${highlightText(regency.name, searchTerm)}
                        <span class="badge badge-custom bg-success ms-2">${regencyCode}</span>
                        <small class="text-muted d-block mt-1">${districtCount} Kecamatan</small>
                    </span>
                `);
                
                // Tombol Detail/Toggle Kecamatan
                const $buttonKabupaten = $(`
                    <button class="btn btn-sm btn-toggle btn-success" 
                            type="button" 
                            data-bs-toggle="collapse" 
                            data-bs-target="#collapse-district-${regencyCode}" 
                            aria-expanded="false" 
                            aria-controls="collapse-district-${regencyCode}">
                        <i class="fas fa-chevron-down me-1"></i> Detail
                    </button>
                `);
                $headerKabupaten.append($buttonKabupaten);
                $liKabupaten.append($headerKabupaten);

                // Container Collapse untuk Kecamatan
                const $collapseKecamatan = $(`<div class="collapse collapse-container" id="collapse-district-${regencyCode}"></div>`);
                const $ulKecamatan = $('<div class="list-group my-2"></div>');

                // Sortir Kecamatan berdasarkan Kode
                const sortedDistCodes = Object.keys(regency.districts).sort();

                $.each(sortedDistCodes, function(index, distCode) {
                    const districtName = regency.districts[distCode];

                    // Item Kecamatan
                    const $liKecamatan = $(`
                        <div class="list-group-item kecamatan-item">
                            <span>
                                ${highlightText(districtName, searchTerm)}
                                <span class="badge badge-custom bg-warning text-dark ms-2">${distCode}</span>
                            </span>
                        </div>
                    `);

                    $ulKecamatan.append($liKecamatan);
                });

                $collapseKecamatan.append($ulKecamatan);
                $liKabupaten.append($collapseKecamatan);
                $ulKabupaten.append($liKabupaten);
            });
            
            $collapseKabupaten.append($ulKabupaten);
            $liProvinsi.append($collapseKabupaten);
            $ulProvinsi.append($liProvinsi);
        });

        $container.append($ulProvinsi);
        
        // Auto expand jika ada pencarian
        if (searchTerm) {
            $('.collapse').collapse('show');
            $('.btn-toggle').html('<i class="fas fa-chevron-up me-1"></i> Sembunyikan');
        }
        
        // Update teks tombol setelah collapse
        $('.btn-toggle').on('click', function() {
            const $icon = $(this).find('i');
            if ($icon.hasClass('fa-chevron-down')) {
                $icon.removeClass('fa-chevron-down').addClass('fa-chevron-up');
                $(this).contents().last().replaceWith(' Sembunyikan');
            } else {
                $icon.removeClass('fa-chevron-up').addClass('fa-chevron-down');
                $(this).contents().last().replaceWith(' Detail');
            }
        });
    }
    
    // Fungsi untuk menyorot teks pencarian
    function highlightText(text, searchTerm) {
        if (!searchTerm) return text;
        
        const regex = new RegExp(`(${searchTerm})`, 'gi');
        return text.replace(regex, '<mark class="bg-warning">$1</mark>');
    }
    
    // Fungsi untuk memfilter data berdasarkan pencarian
    function filterData(data, searchTerm) {
        const filtered = {};
        const lowerSearchTerm = searchTerm.toLowerCase();
        
        for (const provCode in data) {
            const province = data[provCode];
            const provinceMatches = province.name.toLowerCase().includes(lowerSearchTerm);
            
            const filteredRegencies = {};
            for (const regCode in province.regencies) {
                const regency = province.regencies[regCode];
                const regencyMatches = regency.name.toLowerCase().includes(lowerSearchTerm);
                
                const filteredDistricts = {};
                for (const distCode in regency.districts) {
                    const districtName = regency.districts[distCode];
                    const districtMatches = districtName.toLowerCase().includes(lowerSearchTerm);
                    
                    if (districtMatches) {
                        filteredDistricts[distCode] = districtName;
                    }
                }
                
                // Jika kabupaten cocok atau ada kecamatan yang cocok
                if (regencyMatches || Object.keys(filteredDistricts).length > 0) {
                    filteredRegencies[regCode] = {
                        ...regency,
                        districts: filteredDistricts
                    };
                }
            }
            
            // Jika provinsi cocok atau ada kabupaten yang cocok
            if (provinceMatches || Object.keys(filteredRegencies).length > 0) {
                filtered[provCode] = {
                    ...province,
                    regencies: filteredRegencies
                };
            }
        }
        
        return filtered;
    }
    
    // --- FUNGSI UTAMA: MENGAMBIL DAN MEMPROSES DATA ---
    async function fetchDataAndRender() {
        try {
            // Ambil data secara paralel menggunakan fetch API
            const [resProvinsi, resKabupaten, resKecamatan] = await Promise.all([
                fetch(PROVINSI_URL),
                fetch(KABUPATEN_URL),
                fetch(KECAMATAN_URL)
            ]);

            const dataProvinsi = await resProvinsi.json();
            const dataKabupaten = await resKabupaten.json();
            const dataKecamatan = await resKecamatan.json();
            
            // --- Transformasi Data ---
            
            // 1. Provinsi: dari array data menjadi { code: name }
            const provincesMap = dataProvinsi.data.reduce((acc, item) => {
                acc[item.code] = item.name;
                return acc;
            }, {});
            
            // 2. Kabupaten/Kota: dari array data menjadi { code: { name: '...', provinceCode: '...' } }
            const regenciesMap = dataKabupaten.data.reduce((acc, item) => {
                acc[item.code] = {
                    name: item.name,
                    provinceCode: item.code.substring(0, 2)
                };
                return acc;
            }, {});

            // 3. Kecamatan: langsung ambil dari 'sample_data'
            const districtsMap = dataKecamatan.sample_data;
            
            // 4. Kelompokkan dan Render
            allData = groupData(provincesMap, regenciesMap, districtsMap);
            
            updateStats(allData);
            renderHierarchy(allData);

        } catch (error) {
            console.error('Gagal mengambil atau memproses data:', error);
            $('#province-container').html(`
                <div class="alert alert-danger text-center">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Gagal memuat data. Periksa koneksi internet atau konsol browser untuk detail error.
                </div>
            `);
        }
    }
    
    // Eksekusi fungsi utama setelah dokumen siap
    $(document).ready(function() {
        fetchDataAndRender();
        
        // Setup pencarian
        $('#search-input').on('input', function() {
            currentSearchTerm = $(this).val();
            renderHierarchy(allData, currentSearchTerm);
        });
        
        // Hapus animasi pulse setelah data dimuat
        setTimeout(() => {
            $('.pulse').removeClass('pulse');
        }, 2000);
    });

</script>

</body>
</html>


